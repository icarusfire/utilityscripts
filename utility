- bash: |
    set -euo pipefail

    ROOT="$(Pipeline.Workspace)/ReleaseNotes/ReleaseNotesKansCHG"
    RELEASE_DIR="$(find "$ROOT" -maxdepth 1 -mindepth 1 -type d | head -n1)"
    RELEASE_NUMBER="$(basename "$RELEASE_DIR" | cut -d' ' -f1)"

    # read files
    ALL_TEXT="$(< "$RELEASE_DIR/${RELEASE_NUMBER}_all.txt")"
    NOTES_TEXT="$(< "$ROOT/RELEASE_NOTES.md")"

    # set pipeline variables
    echo "##vso[task.setvariable variable=releaseNumber]$RELEASE_NUMBER"
    echo "##vso[task.setvariable variable=shortDescription]Welcome to release $RELEASE_NUMBER"
    # join with a blank line in between
    COMBINED="$(printf "%s\n\n%s" "$NOTES_TEXT" "$ALL_TEXT")"
    # if your combined text is large, consider writing to a file or use multiline vars carefully
    echo "##vso[task.setvariable variable=description]$COMBINED"
  name: setVars
  displayName: Extract and Set Variables
  shell: bash
